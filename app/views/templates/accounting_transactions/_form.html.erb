<div class='row'>
  <div class='col-xs-12 col-sm-offset-2 col-sm-8'>
    <% if @accounting_transaction.id %>
      <div class='row'>
        <div class='col-sm-10'><h2>Update existing accounting transaction for <%= link_to_account_book  %></h2></div>
        <div class='col-sm-2'><h2 style='text-align : left'><%= link_to "delete" , { :controller => "accounting_transactions" , :action => "destroy" } , :method => "delete" , :class => "btn btn-danger" , :data => { :confirm => "Are you sure you want to delete this transaction?" } %></h2></div>
      </div>
    <% else %>
      <h2>Create a new accounting transaction for <%= link_to_account_book %></h2>
    <% end %>
    <%= form_for(@accounting_transaction , 
      :url =>  "", 
      :html => { 
        :"ng-controller" => "accountingTransactionCtrl",
        :"ng-init" => "initializeTransaction(#{@accounting_transaction.to_json})",
        :"ng-submit" => "submit()",
        :"authenticity-token" => form_authenticity_token
      }) do |f| %>
      <%= render "shared/error_messages" , object: f.object %>
      <div ng-show="error_messages" class='alert alert-danger'>
        <ul>
          <li style='list-style-type : none'>You have <strong ng-bind="error_messages.length | pluralize_error_word"></strong></li>
          <li ng-repeat="error_message in error_messages" ng-bind="error_message" style='list-style-type : none'></li>
        </ul>
      </div>
      <div class='form-group'>
        <%= f.label :description %>
        <%= f.text_area :description , :"ng-model" =>"transaction.description", :class => "form-control"%>
      </div>
      <div class="form-group">
        <%= f.label :date , "Date of transaction (defaults to date of transaction creation)" %>
        <%= f.date_field :date , :"ng-model" => "transaction.date" , :class => "form-control" %>
      </div>
      <div class='row'>
        <div id='debit_records' class='col-sm-6' ng-init="initializeRecords('debit' , <%= @accounting_transaction.debit_records.to_json %>)">
          <h2>Debit Records</h2><button type="button" ng-click="addRecord('debit')" class="btn btn-default">Add new debit record</button>
          <div ng-repeat="record in transaction.debit_records_attributes">
            <%= render partial: "record_form" %>
          </div>
        </div>
        <div id='credit_records' class='col-sm-6' ng-init="initializeRecords('credit' , <%= @accounting_transaction.credit_records.to_json %>)">
          <h2>Credit Records</h2><button type="button" ng-click="addRecord('credit')" class="btn btn-default">Add new credit record</button>
          <div ng-repeat="record in transaction.credit_records_attributes">
            <%= render partial: "record_form" %>
          </div>
        </div>
      </div>
      <br />
      <div class='row'>
      <% if @accounting_transaction.id %>
        <div class='col-sm-6'><%= f.submit "update transaction" , :class => "btn btn-primary" %></div>
      <% else %>
        <div class='col-sm-6'><%= f.submit "create transaction" , :class => "btn btn-primary" %></div>
      <% end %>
      </div>
    <% end %>
    <br />  
  </div>
</div>